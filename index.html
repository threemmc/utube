<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouLite</title>
<style>
  :root {
    --bg: #fff;
    --text: #222;
    --card: #f5f5f5;
    --button: #e0e0e0;
  }
  body.dark {
    --bg: #121212;
    --text: #eee;
    --card: #1e1e1e;
    --button: #2a2a2a;
  }
  body {
    margin:0;
    background: var(--bg);
    color: var(--text);
    font-family: sans-serif;
    display:flex;
    flex-direction:column;
    height:100vh;
    transition: background 0.3s, color 0.3s;
  }
  .page {
    flex:1;
    display:none;
    padding:12px;
    overflow-y:auto;
    animation: fade 0.3s;
  }
  @keyframes fade {
    from {opacity:0; transform: translateX(20px);}
    to {opacity:1; transform: translateX(0);}
  }
  .active {display:block;}
  .tabs {
    display:flex;
    justify-content: space-around;
    border-top:1px solid #ccc;
    background:var(--card);
    padding:6px 0;
  }
  .tabs button {
    flex:1;
    background:none;
    border:none;
    font-size:14px;
    font-weight:bold;
    color:var(--text);
  }
  .card {
    background:var(--card);
    padding:10px;
    border-radius:8px;
    margin:8px 0;
    position:relative;
  }
  .remove {
    position:absolute;
    top:5px; right:8px;
    background:red;
    color:#fff;
    border:none;
    border-radius:50%;
    width:20px; height:20px;
    cursor:pointer;
  }
  .video-list {display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .video-item {cursor:pointer;}
  .video-item img {width:100%;border-radius:6px;}
  #player-wrap {display:none; margin:10px 0;}
  .fav-btn {
    display:block;
    margin-top:5px;
    background:gold;
    border:none;
    border-radius:6px;
    padding:4px;
    cursor:pointer;
  }
  /* –ê–¥–∞–ø—Ç–∏–≤ */
  @media(max-width:600px){
    .video-list {grid-template-columns:1fr;}
    .tabs button {font-size:12px;}
  }
</style>
</head>
<body>

<div id="home" class="page active">
  <h2>–ì–ª–∞–≤–Ω–∞—è</h2>
  <div id="player-wrap"><iframe id="player" width="100%" height="315" frameborder="0" allowfullscreen></iframe></div>
  <div id="fav-list"></div>
</div>

<div id="subs" class="page">
  <h2>–ü–æ–¥–ø–∏—Å–∫–∏</h2>
  <input id="chan-url" placeholder="@username –∏–ª–∏ —Å—Å—ã–ª–∫–∞">
  <button id="add-chan">–î–æ–±–∞–≤–∏—Ç—å</button>
  <select id="sort">
    <option value="date">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –¥–∞—Ç–µ</option>
    <option value="channel">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –∫–∞–Ω–∞–ª—É</option>
  </select>
  <div id="subs-list"></div>
</div>

<div id="profile" class="page">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <button id="toggle-theme">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
</div>

<div class="tabs">
  <button onclick="showPage('home')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
  <button onclick="showPage('subs')">üì∫ –ü–æ–¥–ø–∏—Å–∫–∏</button>
  <button onclick="showPage('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
</div>

<script>
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
  function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // –¢–µ–º–∞
  function applyTheme(){
    const theme=localStorage.getItem('theme')||'light';
    document.body.classList.toggle('dark', theme==='dark');
  }
  applyTheme();
  document.getElementById('toggle-theme').onclick=()=>{
    const isDark=document.body.classList.toggle('dark');
    localStorage.setItem('theme', isDark?'dark':'light');
  };

  // –ü–æ–¥–ø–∏—Å–∫–∏
  function loadChannels(){return JSON.parse(localStorage.getItem('channels')||'[]');}
  function saveChannels(arr){localStorage.setItem('channels',JSON.stringify(arr));}
  async function parseChannelId(str){
    try{
      const u=new URL(str);
      if(u.pathname.includes('/channel/')) return u.pathname.split('/')[2];
      if(u.searchParams.get('channel_id')) return u.searchParams.get('channel_id');
      if(u.pathname.startsWith('/@')){
        const res=await fetch(u.href); const text=await res.text();
        const m=text.match(/"channelId":"(UC[0-9A-Za-z_-]+)"/); if(m) return m[1];
      }
    }catch{}
    if(str.startsWith('@')){
      try{
        const res=await fetch(`https://www.youtube.com/${str}`);
        const text=await res.text();
        const m=text.match(/"channelId":"(UC[0-9A-Za-z_-]+)"/); if(m) return m[1];
      }catch{}
    }
    return null;
  }

  document.getElementById('add-chan').onclick=async ()=>{
    const raw=document.getElementById('chan-url').value.trim();
    if(!raw) return alert('–ü—É—Å—Ç–æ');
    const id=await parseChannelId(raw);
    if(!id) return alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–∞–Ω–∞–ª');
    let arr=loadChannels();
    if(!arr.includes(id)){arr.push(id); saveChannels(arr);}
    document.getElementById('chan-url').value='';
    loadSubs();
  };

  async function loadSubs(){
    const subsList=document.getElementById('subs-list');
    subsList.innerHTML='';
    let chans=loadChannels();
    if(chans.length===0){subsList.innerHTML='<div class="muted">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫</div>';return;}

    const sort=document.getElementById('sort').value;

    for(const id of chans){
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`<div class="muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–∞ ${id}...</div>`;
      subsList.appendChild(card);
      try{
        const rss=`https://www.youtube.com/feeds/videos.xml?channel_id=${id}`;
        const res=await fetch(rss);
        const text=await res.text();
        const xml=new DOMParser().parseFromString(text,"application/xml");
        const title=xml.querySelector('feed > title')?.textContent||id;
        const entries=[...xml.querySelectorAll('entry')];
        card.innerHTML=`<button class="remove">√ó</button><h3>${title}</h3><div class="video-list"></div>`;
        const list=card.querySelector('.video-list');

        entries.forEach(e=>{
          const vid=e.querySelector('yt\\:videoId')?.textContent;
          const vtitle=e.querySelector('title')?.textContent;
          const thumb=`https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;
          const item=document.createElement('div');
          item.className='video-item';
          item.innerHTML=`<a href="#"><img src="${thumb}"><div>${vtitle}</div></a>
                          <button class="fav-btn" data-id="${vid}" data-title="${vtitle}">‚òÖ –í –∑–∞–∫–ª–∞–¥–∫–∏</button>`;
          item.querySelector('a').onclick=(ev)=>{
            ev.preventDefault();
            showPage('home');
            document.getElementById('player').src=`https://www.youtube-nocookie.com/embed/${vid}`;
            document.getElementById('player-wrap').style.display='block';
          };
          item.querySelector('.fav-btn').onclick=()=>{
            addFav(vid,vtitle);
          };
          list.appendChild(item);
        });

        // —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
        card.querySelector('.remove').onclick=()=>{
          let arr=loadChannels();
          arr=arr.filter(c=>c!==id);
          saveChannels(arr);
          loadSubs();
        };
      }catch(e){
        card.innerHTML=`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${id}`;
      }
    }
  }

  document.getElementById('sort').onchange=loadSubs;

  // –ó–∞–∫–ª–∞–¥–∫–∏
  function loadFavs(){return JSON.parse(localStorage.getItem('favs')||'[]');}
  function saveFavs(arr){localStorage.setItem('favs',JSON.stringify(arr));}
  function addFav(id,title){
    let arr=loadFavs();
    if(!arr.find(v=>v.id===id)){arr.push({id,title}); saveFavs(arr);}
    renderFavs();
  }
  function renderFavs(){
    const favDiv=document.getElementById('fav-list');
    favDiv.innerHTML='<h3>–ó–∞–∫–ª–∞–¥–∫–∏</h3>';
    loadFavs().forEach(v=>{
      const d=document.createElement('div');
      d.className='card';
      d.innerHTML=`<a href="#">${v.title}</a>`;
      d.querySelector('a').onclick=(ev)=>{
        ev.preventDefault();
        document.getElementById('player').src=`https://www.youtube-nocookie.com/embed/${v.id}`;
        document.getElementById('player-wrap').style.display='block';
      };
      favDiv.appendChild(d);
    });
  }

  loadSubs(); renderFavs();
</script>

</body>
</html>
